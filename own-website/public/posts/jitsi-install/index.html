<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />
	<link rel="shortcut icon" href="/img/me.ico" >
	<meta name="description" content="Personal website of Gokberk Gunes.">
	<title>Jitsi Installation on Artix Linux | Gokberk Gunes</title>
	
</head>

<body>

<div id="container">
<link rel="stylesheet" type="text/css" href="/css/index.css">
<nav class="navBar" scrolling="no">
	
	<ul class="navMenu">
		<li class="navItemImg"><a class="navLinkImg" href="base"><img src=/img/me.jpg alt="picture"></a></img></li>
		
		<li class="navItem"> <a href="base/"  > Home</a></li>
		
		<li class="navItem"> <a href="base/posts"  > Posts</a></li>
		
		<li class="navItem"> <a href="https://github.com/gokberkgunes" target="_blank" > Github</a></li>
		
		<li class="navItem"> <a href="https://searx.berksen.net"  > Search</a></li>
		
		<li class="navItem"> <a href="https://libreddit.berksen.net"  > Reddit</a></li>
		
		<li class="navItem"> <a href="https://nitter.berksen.net"  > Twitter</a></li>
		
		<li class="navItem"> <a href="https://meet.berksen.net"  > Jitsi</a></li>
		
	</ul>
</nav>

<main class="content">




<h1>Jitsi Installation on Artix Linux</h1>

<p>This article will guide one to set up video conference website called Jitsi.
Jitsi is an open-source and an ethical piece of software. It must be preferred
to spyware programs like Zoom, Google Meet, Microsoft Teams and such proprietary
alternatives. All of these malicious programs got popularized and enforced by
people who has no idea about technology. Consequently, for the people with
freedom and security in mind, Jitsi is the prime service to use and self-host.
This guide will cover the self-hosting part, usage is piece of cake anyway.
(The guide is adapted from Arch Linux&rsquo; wiki page and Celogreek&rsquo;s guide.)</p>
<p>Below one may find references, useful links to accompany this guide.</p>
<ul>
<li>

<a href="https://github.com/jitsi/jitsi-meet/tree/master/doc/debian/" target="_blank" rel="noopener noreferrer">Configuration files</a></li>
<li>

<a href="https://wiki.archlinux.org/title/Jitsi-meet" target="_blank" rel="noopener noreferrer">Arch wiki</a></li>
<li>

<a href="https://blog.celogeek.com/posts/linux/archlinux/2021-02-jitsi-meet-nighly-on-arch-linux/" target="_blank" rel="noopener noreferrer">Celogreek&rsquo;s guide</a></li>
</ul>
<p>Switch to root account, keep using root throughout the whole guide. (Use sudo
or su preferably.)</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>doas su</span></span></code></pre></div></div>

<p>Install required programs.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pacman -S git gnupg nginx-mainline curl jdk11-openjdk maven npm unzip prosody</span></span></code></pre></div></div>

<p>Append two lines of code to set a local loopback.  The programs we are going to
install will talk to each other with local loopback.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/hosts
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">127.0.0.1 YOUR_DOMAIN auth.YOUR_DOMAIN
::1 YOUR_DOMAIN auth.YOUR_DOMAIN
</code></pre><h2 id="jicofo-installation">Jicofo Installation</h2>
<h3 id="cloning-and-installing-jicofo">Cloning and Installing Jicofo</h3>
<p>Clone the repository from official repositories, then compile Jicofo.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir /srv/http/jitsi/sources &amp;&amp; <span style="color:#24909d">cd</span> /srv/http/jitsi/sources
</span></span><span style="display:flex;"><span>git clone <span style="color:#ed9d13">&#34;https://github.com/jitsi/jicofo.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#24909d">cd</span> jicofo
</span></span><span style="display:flex;"><span>mvn package -DskipTests -Dassembly.skipAssembly=false</span></span></code></pre></div></div>

<p>After compilation is done move the compiled files to your server&rsquo;s system
folders.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>unzip jicofo/target/jicofo-*.zip -d /srv/http/jitsi/
</span></span><span style="display:flex;"><span>mv /srv/http/jitsi/jicofo-* /srv/http/jitsi/jicofo
</span></span><span style="display:flex;"><span>rm /srv/http/jitsi/jicofo/jicofo.bat</span></span></code></pre></div></div>

<h3 id="creating-and-modifying-configuration-files">Creating and Modifying Configuration Files</h3>
<p>Move configuration files to system folders.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/jicofo/
</span></span><span style="display:flex;"><span>mv lib/logging.properties /etc/jicofo
</span></span><span style="display:flex;"><span>mv jicofo-selector/src/main/resources/reference.conf /etc/jicofo/jicofo.conf</span></span></code></pre></div></div>

<p>In configuration file of jicofo change below sections to your domain adress. If
they are commented out with either <strong>//</strong> or <strong>#</strong> remove it.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jicofo/jicofo.conf
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">xmpp {
	...
	conference-muc-jid = conference.meet.berksen.net

	...

      client-proxy = focus.meet.berksen.net

	...
    }
</code></pre><p>Create a user and group for jicofo.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;g jitsi\nu jicofo -:jitsi - /var/lib/jicofo&#34;</span> &gt; /usr/lib/sysusers.d/jicofo.conf
</span></span><span style="display:flex;"><span>sysusers</span></span></code></pre></div></div>

<p>In below file modify <strong>JICOFO_HOSTNAME</strong>, <strong>JICOFO_AUTH_DOMAIN</strong>,
<strong>JICOFO_AUTH_PASSWORD</strong> with your information.</p>
<p>Change <strong>meet.berksen.net</strong> to your domain adress and change password to your
focus user&rsquo;s password. For the password, the one may use <code>openssl rand -hex 16</code>.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jicofo/config
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb"># Jitsi Conference Focus settings
# sets the host name of the XMPP server
export JICOFO_HOST=localhost

# sets the XMPP domain (default: none)
export JICOFO_HOSTNAME=meet.berksen.net

# sets the XMPP domain name to use for XMPP user logins
export JICOFO_AUTH_DOMAIN=auth.meet.berksen.net

# sets the username to use for XMPP user logins
export JICOFO_AUTH_USER=focus

# the password to use for XMPP user logins (focus user)
export JICOFO_AUTH_PASSWORD=password1

# extra options to pass to the jicofo daemon
export JICOFO_OPTS=&#34;&#34;

# adds java system props that are passed to jicofo (default are for home and
# logging config file)
export JAVA_SYS_PROPS=&#34;\
 -Dnet.java.sip.communicator.SC_HOME_DIR_LOCATION=/etc\
 -Dnet.java.sip.communicator.SC_HOME_DIR_NAME=jicofo\
 -Dnet.java.sip.communicator.SC_LOG_DIR_LOCATION=/var/log/jicofo\
 -Djava.util.logging.config.file=/etc/jicofo/logging.properties\
 -Dconfig.file=/etc/jicofo/jicofo.conf\
 -Djava.util.prefs.userRoot=/var/lib/jicofo\
&#34;
</code></pre><p>Create the communicator file. Change <strong>meet.berksen.net</strong> to your address.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;org.jitsi.jicofo.BRIDGE_MUC=JvbBrewery@internal.auth.meet.berksen.net&#34;</span> &gt; /etc/jicofo/sip-communicator.properties</span></span></code></pre></div></div>

<h3 id="runit-script-generation">Runit Script Generation</h3>
<p>Create a runit script files for the jitsi-videobridge for logging and running.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/runit/sv/jicofo/log
</span></span><span style="display:flex;"><span>touch /etc/runit/sv/jicofo/log/run /etc/runit/sv/jicofo/run
</span></span><span style="display:flex;"><span>chmod +x /etc/runit/sv/jicofo/log/run /etc/runit/sv/jicofo/run</span></span></code></pre></div></div>

<p>Edit service script.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/runit/sv/jicofo/run
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">#!/bin/sh
exec 2&gt;&amp;1; set -e

# Read config file whichsets other configuration files&#39; locations.
. /etc/jicofo/config

exec chpst -u jicofo:jitsi /srv/http/jitsi/jicofo/jicofo.sh --host=$JICOFO_HOST --domain=$JICOFO_HOSTNAME --user_name=$JICOFO_AUTH_USER --user_domain=$JICOFO_AUTH_DOMAIN $JICOFO_OPTS
</code></pre><p>Edit logging script.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/runit/sv/jicofo/log/run
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">#!/bin/sh
exec 2&gt;&amp;1; set -e

[ -d /var/log/jitsivid ] || install -dm 755 /var/log/jitsivid

exec svlogd -tt /var/log/jitsivid
</code></pre><p>Start runit service.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ln -s /etc/runit/sv/jicofo /run/runit/service</span></span></code></pre></div></div>

<h2 id="jitsi-videobridge-installation">Jitsi Videobridge Installation</h2>
<p>Clone the repository and compile jitsi-videobridge.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#24909d">cd</span> /srv/http/jitsi/sources/
</span></span><span style="display:flex;"><span>git clone <span style="color:#ed9d13">&#34;https://github.com/jitsi/jitsi-videobridge.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#24909d">cd</span> jitsi-videobridge
</span></span><span style="display:flex;"><span>mvn package -DskipTests -Dassembly.skipAssembly=<span style="color:#24909d">true</span> install</span></span></code></pre></div></div>

<p>After compilation is done move the compiled files to your server&rsquo;s location.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>unzip jvb/target/jitsi-videobridge-*.zip -d /srv/http/jitsi/
</span></span><span style="display:flex;"><span>mv /srv/http/jitsi/jitsi-videobridge-* /srv/http/jitsi/jitsi-videobridge
</span></span><span style="display:flex;"><span>rm /srv/http/jitsi/jitsi-videobridge/jvb.bat</span></span></code></pre></div></div>

<p>Move java configuration file and then kernel setting file.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/jitsi-videobridge/
</span></span><span style="display:flex;"><span>mv jvb/lib/logging.properties config/callstats-java-sdk.properties /etc/jitsi-videobridge
</span></span><span style="display:flex;"><span>mkdir -p /etc/sysctl.d
</span></span><span style="display:flex;"><span>mv config/20-jvb-udp-buffers.conf /etc/sysctl.d</span></span></code></pre></div></div>

<p>Create a user and group for jitsi-videobridge.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;g jitsi\nu jvb -:jitsi - /var/lib/jitsi-videobridge&#34;</span> &gt; /usr/lib/sysusers.d/jitsi.conf
</span></span><span style="display:flex;"><span>sysusers</span></span></code></pre></div></div>

<p>Create config file and fill <strong>JVB_HOSTNAME</strong>. Change <strong>meet.berksen.net</strong>
to your domain. Use <code>opensll rand -hex 16</code> for <strong>JVB_SECRET</strong>.</p>
<p>Note that, config file should be empty at this point to have a working server.
This file will be used for socket later on.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-videobridge/config
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb"># Jitsi Videobridge settings

# sets the XMPP domain (default: none)
export JVB_HOSTNAME=meet.berksen.net

# sets the hostname of the XMPP server (default: domain if set, localhost otherwise)
export JVB_HOST=

# sets the port of the XMPP server (default: 5275)
export JVB_PORT=5347

# shared secret used to authenticate to the XMPP server (jvb user)
export JVB_SECRET=password2

# extra options to pass to the JVB daemon
export JVB_OPTS=&#34;--apis=,&#34;

# adds java system props that are passed to jvb (default are for home and logging config file)
export JAVA_SYS_PROPS=&#34;\
  -Dnet.java.sip.communicator.SC_HOME_DIR_LOCATION=/etc\
  -Dnet.java.sip.communicator.SC_HOME_DIR_NAME=jitsi-videobridge\
  -Dnet.java.sip.communicator.SC_LOG_DIR_LOCATION=/var/log/jitsi-videobridge\
  -Djava.util.logging.config.file=/etc/jitsi-videobridge/logging.properties\
  -Djava.util.prefs.userRoot=/var/lib/jitsi-videobridge\
&#34;
# Below config belongs to JAVA_SYS_PROPS, but causes jitsi to not work.
#  -Dconfig.file=/etc/jitsi-videobridge/jvb.conf\
</code></pre><p>Create communicator file. Change <strong>shard.DOMAIN</strong>, <strong>shard.PASSWORD</strong> as jvb password
which is set on config file above as <strong>JVB_SECRET</strong>, lastly modify
<strong>shard.MUC_JIDS</strong>. <strong>Shard.MUC_NICKNAME</strong> will be generated with <code>uuidgen</code>
command.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-videobridge/sip-communicator.properties
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">org.ice4j.ice.harvest.DISABLE_AWS_HARVESTER=true
org.ice4j.ice.harvest.STUN_MAPPING_HARVESTER_ADDRESSES=meet-jit-si-turnrelay.jitsi.net:443
org.jitsi.videobridge.ENABLE_STATISTICS=true
org.jitsi.videobridge.STATISTICS_TRANSPORT=muc
org.jitsi.videobridge.xmpp.user.shard.HOSTNAME=localhost
org.jitsi.videobridge.xmpp.user.shard.DOMAIN=auth.meet.berksen.net
org.jitsi.videobridge.xmpp.user.shard.USERNAME=jvb
org.jitsi.videobridge.xmpp.user.shard.PASSWORD=password
org.jitsi.videobridge.xmpp.user.shard.MUC_JIDS=JvbBrewery@internal.auth.meet.berksen.net
org.jitsi.videobridge.xmpp.user.shard.MUC_NICKNAME=uuid
</code></pre><h3 id="runit-script-generation-1">Runit Script Generation</h3>
<p>Create a runit script for the jitsi-videobridge.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/runit/sv/jitsi-videobridge/log
</span></span><span style="display:flex;"><span>touch /etc/runit/sv/jitsi-videobridge/log/run /etc/runit/sv/jitsi-videobridge/run
</span></span><span style="display:flex;"><span>chmod +x /etc/runit/sv/jitsi-videobridge/log/run /etc/runit/sv/jitsi-videobridge/run</span></span></code></pre></div></div>

<p>Edit service script.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/runit/sv/jitsi-videobridge/run
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">#!/bin/sh
exec 2&gt;&amp;1; set -e


# Read config file whichsets other configuration files&#39; locations.
. /etc/jitsi-videobridge/config

exec chpst -u jvb:jitsi /srv/http/jitsi/jitsi-videobridge/jvb.sh $JVB_OPTS
</code></pre><p>Edit logging script.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/runit/sv/jitsi-videobridge/log/run
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">#!/bin/sh
exec 2&gt;&amp;1; set -e

[ -d /var/log/jitsivid ] || install -dm 755 /var/log/jitsivid

exec svlogd -tt /var/log/jitsivid
</code></pre><p>Start runit service.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ln -s /etc/runit/sv/jitsi-videobridge /run/runit/service</span></span></code></pre></div></div>

<h2 id="jitsi-meet-installation">Jitsi-Meet Installation</h2>
<p>Clone the repository and compile jicofo. Make command for jitsi-meet will not
work cause of ram limitations in java settings. Then one has to change it with
<em>NODE_OPTIONS</em> environmental variable as shown below.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /srv/http/jitsi/; <span style="color:#24909d">cd</span> /srv/http/jitsi
</span></span><span style="display:flex;"><span>git clone <span style="color:#ed9d13">&#34;https://github.com/jitsi/jitsi-meet.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#24909d">cd</span> jitsi-meet/
</span></span><span style="display:flex;"><span><span style="color:#24909d">export</span> <span style="color:#40ffff">NODE_OPTIONS</span>=<span style="color:#ed9d13">&#34;--max-old-space-size=8192&#34;</span>
</span></span><span style="display:flex;"><span>npm install
</span></span><span style="display:flex;"><span>make</span></span></code></pre></div></div>

<p>After compilation is done symlink the compiled files to reachable location.
Note that there used to be configuration file called <strong>logging_config.js</strong>, it is
now merged into <strong>config.js</strong>. In the future <strong>interface_config.js</strong> is going
to merge into <strong>config.js</strong> as well.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/jitsi-meet
</span></span><span style="display:flex;"><span>ln -sf /srv/http/jitsi/jitsi-meet/interface_config.js /etc/jitsi-meet/
</span></span><span style="display:flex;"><span>ln -sf /srv/http/jitsi/jitsi-meet/config.js /etc/jitsi-meet/</span></span></code></pre></div></div>

<ul>
<li>Edit main configuration file, find below options and alter them for your own
domain.</li>
</ul>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-meet/config.js
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">var config = {
    ...
	hosts: {
		// XMPP domain.
		domain: &#39;meet.berksen.net&#39;,

		...
		// XMPP MUC domain. FIXME: use XEP-0030 to discover it.
		muc: &#39;conference.meet.berksen.net&#39;,
	},

	// BOSH URL. FIXME: use XEP-0156 to discover it.
	bosh: &#39;//meet.berksen.net/http-bind&#39;,

	...
}
</code></pre><h2 id="prosody-configuration">Prosody Configuration</h2>
<p>Make a config folder and config file and include config file to settings.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/prosody/conf.d
</span></span><span style="display:flex;"><span>curl <span style="color:#ed9d13">&#34;https://raw.githubusercontent.com/jitsi/jitsi-meet/master/doc/debian/jitsi-meet-prosody/prosody.cfg.lua-jvb.example&#34;</span> &gt; /etc/prosody/conf.d/jitsi.cfg.lua
</span></span><span style="display:flex;"><span><span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;Include \&#34;conf.d/*.cfg.lua\&#34;&#34;</span> &gt;&gt; /etc/prosody/prosody.cfg.lua</span></span></code></pre></div></div>

<p>Change domain names to your domain as described below.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/prosody/conf.d/jitsi.cfg.lua
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">Replace all:

    &#34;jitmeet.example.com&#34; with &#34;meet.berksen.net&#34;
    &#34;focusUser@auth.meet.berksen.net&#34; with &#34;focus@auth.meet.berksen.net&#34;
</code></pre><p>Then adjust the configuration at your needs.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/prosody/conf.d/jitsi.cfg.lua
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">plugin_paths = { &#34;/srv/http/jitsi/jitsi-meet/resources/prosody-plugins/&#34; }
</code></pre><p>Generate certificates. (Must have CNAME records by DNS). There are going to be
some warnings about certificate for hosts. These are not important since these
are all virtual hosts. Only meet.berksen.net and auth.meet.berksen.net are
important.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>certbot --nginx certonly -d meet.berksen.net
</span></span><span style="display:flex;"><span>certbot --nginx certonly -d auth.meet.berksen.net</span></span></code></pre></div></div>

<p>Create a letsencrypt renewal hook. This way, whenever one renews letsencrypt
certificates, prosody certificates will automatically imported.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/letsencrypt/renewal-hooks/deploy/prosody
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">#!/usr/bin/sh
/usr/bin/prosodyctl --root cert import /etc/letsencrypt/live
</code></pre><p>Make the hook file executable.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>chmod +x /etc/letsencrypt/renewal-hooks/deploy/prosody</span></span></code></pre></div></div>

<ul>
<li>Config written to /var/lib/prosody/meet.berksen.net.cnf</li>
<li>Certificate written to /var/lib/prosody/meet.berksen.net.crt</li>
</ul>
<p>Now set keys and certificates, add these below.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/prosody/conf.d/jitsi.cfg.lua
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">
VirtualHost &#34;meet.berksen.net&#34;
	...
	ssl = {
		key = &#34;/etc/prosody/certs/meet.berksen.net.key&#34;;
		certificate = &#34;/etc/prosody/certs/meet.berksen.net.crt&#34;;
	}

	...

VirtualHost &#34;auth.meet.berksen.net&#34;
	ssl = {
		key = &#34;/etc/prosody/certs/auth.meet.berksen.net.key&#34;;
		certificate = &#34;/etc/prosody/certs/auth.meet.berksen.net.crt&#34;;
	}
	authentication = &#34;internal_hashed&#34;
</code></pre><h2 id="nginx--jitsi-connection">Nginx &amp; Jitsi Connection</h2>
<p>Make a config folder and config file as <strong>jitsi.conf</strong>.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir -p /etc/nginx/enabled-sites
</span></span><span style="display:flex;"><span>mkdir -p /etc/nginx/sites
</span></span><span style="display:flex;"><span>curl <span style="color:#ed9d13">&#34;https://github.com/jitsi/jitsi-meet/blob/master/doc/debian/jitsi-meet/jitsi-meet.example&#34;</span> &gt; /etc/nginx/sites
</span></span><span style="display:flex;"><span>mv /etc/nginx/sites/jitsi-meet.example /etc/nginx/sites/jitsi.conf
</span></span><span style="display:flex;"><span>ln -sf /etc/nginx/sites/jitsi.conf /etc/nginx/enabled-sites</span></span></code></pre></div></div>

<p>Modify nginx&rsquo;s configuration file to include all the configuration files
located in sites folder. This include statement should go in to the http part.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/nginx/nginx.conf
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">http {

	...

	include /etc/nginx/enabled-sites/*.conf;

	...

}
</code></pre><p>Alter <strong>jitsi.conf</strong> to include your domain names, SSL certificates,
installation file paths.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/nginx/enabled-sites/jitsi.conf
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">server {
	...

	server_name meet.berksen.net;

	...

	ssl_certificate /etc/prosody/certs/meet.berksen.net.crt;
	ssl_certificate_key /etc/prosody/certs/meet.berksen.net.key;

	root /srv/http/jitsi/jitsi-meet;

	location = /config.js {
		alias /srv/http/jitsi/jitsi-meet/config.js;
	}

	location = /external_api.js {
		alias /srv/http/jitsi/jitsi-meet/libs/external_api.min.js;
	}

	...

	# ensure all static content can always be found first
	location ~ ^/(libs|css|static|images|fonts|lang|sounds|connection_optimization|.well-known)/(.*)$
	{
		alias /srv/http/jitsi/jitsi-meet/$1/$2;

		...
	}

	...

	location ~ ^/([^/?&amp;:&#39;&#34;]+)/config.js$
	{

		...
		alias /srv/http/jitsi/jitsi-meet/config.js;
	}
</code></pre><p>Check if any problem exists with the nginx&rsquo;s configuration file.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>nginx -t</span></span></code></pre></div></div>

<h2 id="register-users">Register Users</h2>
<p>Register for jicofo. (Check password at /etc/jicofo/config)</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>prosodyctl register focus auth.meet.berksen.net password1</span></span></code></pre></div></div>

<p>Register for jitsi-videobridge. (Check password at /etc/jitsi-videobridge/config)</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>prosodyctl register jvb auth.meet.berksen.net password2</span></span></code></pre></div></div>

<p>Subscribe to mod_roster_command.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>prosodyctl mod_roster_command subscribe focus.meet.berksen.net focus@auth.meet.berksen.net</span></span></code></pre></div></div>

<p>Restart runit services.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sv restart prosody
</span></span><span style="display:flex;"><span>sv restart jitsi-videobridge
</span></span><span style="display:flex;"><span>sv restart jicofo
</span></span><span style="display:flex;"><span>sv restart nginx</span></span></code></pre></div></div>

<p><strong>NOTE</strong>: To check current jicofo users refer to 

<a href="https://github.com/jitsi/jitsi-meet/issues/5625" target="_blank" rel="noopener noreferrer">https://github.com/jitsi/jitsi-meet/issues/5625</a></p>
<h2 id="activate-websockets">Activate Websockets</h2>
<p>This part of the installation is done so that the server&rsquo;s load could decrease
and the Jitsi process get faster.</p>
<p>Activate websocket on jitsi-meet side.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-meet/config.js
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">var config = {
	...

	// Websocket URL
	websocket: &#39;wss://meet.berksen.net/xmpp-websocket&#39;,

	...
}
</code></pre><p>Activate websocket module on prosody configuration file.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/prosody/conf.d/jitsi.cfg.lua
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">consider_websocket_secure = true;
cross_domain_websocket = true;

VirtualHost &#34;meet.berksen.net&#34;
	...

	modules_enabled = {
		...
		&#34;websocket&#34;; -- Enable websocket.
		...
	}
</code></pre><p>Copy the reference configuration file to the system.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp /srv/http/jitsi/sources/jitsi-videobridge/jvb/src/main/resources/reference.conf /etc/jitsi-videobridge/</span></span></code></pre></div></div>

<p>Set sockets on jitsi-videobridge.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-videobridge/reference.conf
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">videobridge {
	http-servers {
		...
		public {
			...
			port = 9090
			...
		}
		...
	}
	...
	websockets {
		...
		enabled=true
		server-id=&#34;default-id&#34;
		tls=true
		domain=&#34;meet.berksen.net:443&#34;
		...
	}
}
</code></pre><p>Add socket info to jitsi-videobridge config file back.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-videobridge/config
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">...
# adds java system props that are passed to jvb (default are for home and logging config file)
export JAVA_SYS_PROPS=&#34;\
  -Dnet.java.sip.communicator.SC_HOME_DIR_LOCATION=/etc\
  -Dnet.java.sip.communicator.SC_HOME_DIR_NAME=jitsi-videobridge\
  -Dconfig.file=/etc/jitsi-videobridge/reference.conf\
  -Dnet.java.sip.communicator.SC_LOG_DIR_LOCATION=/var/log/jitsi-videobridge\
  -Djava.util.logging.config.file=/etc/jitsi-videobridge/logging.properties\
  -Djava.util.prefs.userRoot=/var/lib/jitsi-videobridge\
&#34;
</code></pre><p>Restart the services.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sv restart prosody
</span></span><span style="display:flex;"><span>sv restart jitsi-videobridge</span></span></code></pre></div></div>

<h2 id="disallow-room-creations">Disallow Room Creations</h2>
<p>The rationale is to stop random people to create and use rooms, this server is
not free to use.</p>
<ul>
<li>Add below to jicofo&rsquo;s sip communicator file, use correct domain name.</li>
</ul>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jicofo/sip-communicator.properties
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">org.jitsi.jicofo.auth.URL=XMPP:meet.berksen.net
</code></pre><p>Alter jitsi-meet&rsquo;s configuration file for your domain names.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/jitsi-meet/config.js
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">var config = {
	...
	host: {
		...
		// When using authentication, domain for guest users.
		anonymousdomain: &#39;guest.meet.berksen.net&#39;,
		...
	},
	...
}
</code></pre><p>Modify jitsi&rsquo;s prosody configuration file. Change authentification for main
domain, add guest domain with anonymous authentication. Use same modules you
use for your main virtualhost but remove muc_lobby_rooms from it.</p>
<pre tabindex="0"><code class="language-txtt" data-lang="txtt">/etc/prosody/conf.d/jitsi.cfg.lua
</code></pre><pre tabindex="0"><code class="language-txtb" data-lang="txtb">...
VirtualHost &#34;meet.berksen.net&#34;
	...
	authentification = &#34;internal_plain&#34;

-- add guest virtual host to allow anonymous user to join your room
VirtualHost &#34;guest.meet.berksen.net&#34;
        authentication = &#34;anonymous&#34;
        c2s_require_encryption = false
	modules_enabled = {
		&#34;bosh&#34;;
		&#34;pubsub&#34;;
		&#34;ping&#34;; -- Enable mod_ping
		&#34;websocket&#34;; -- Enable websocket.
		&#34;speakerstats&#34;;
		&#34;external_services&#34;;
		&#34;conference_duration&#34;;
		&#34;muc_breakout_rooms&#34;;
		&#34;av_moderation&#34;;
    }
    ...
</code></pre><p>Now, register users as many as required.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>prosodyctl register user_name meet.berksen.net password_here</span></span></code></pre></div></div>

<p>Restart services.</p>





<div class=""><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sv restart jicofo
</span></span><span style="display:flex;"><span>sv restart prosody</span></span></code></pre></div></div>





</main>
</div>
<footer>
	<div class ="footer_frame", scrolling="no">
		<span class="update-date">Last update: 2022-11-15</span>
		<span class="license"><a href="https://www.gnu.org/licenses/fdl-1.3.html" target="_blank" rel="noopener noreferrer"><img src=/img/gnuNoBackground.png alt="license"></img>License</a></span>
	</div>
</footer>
</body>

</html>

